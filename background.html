    <html>
    <head>
    <script>


// var chromeBookmarks = new Array();

// function setChromeBookmarks(bookmarks){
//     chromeBookmarks = bookmarks;
// }

// var googleBookmarks = new Array();

// function setGoogleBookmarks(bookmarks){
//     googleBookmarks = bookmarks;
// }


function init(){
    // updateGoogleBookmarks();    
    updateChromeBookmarks();
    // displayChromeBookmarks();
    // setChromeBookmarks();
    // mergeBookmarks();
    // getGoogleBookmarks();
    // getAndMergeBookmarks();
}

function updateGoogleBookmarks(){
    var xhr = new XMLHttpRequest();
    xhr.open("GET","http://www.google.com/bookmarks/?output=xml&num=10000",true);
    xhr.onreadystatechange = function() {
        if (xhr.readyState == 4){
            xhr.responseXML.documentElement.getElementsByTagName('bookmark');
        };
    };
    xhr.send(null);
}


function updateChromeBookmarks(){
    chrome.bookmarks.getTree(function(bookmarkTreeNode) {
                                 var chromeBookmarks = bookmarkTreeNode[0].children[1].children; 
                                 var xhr = new XMLHttpRequest();
                                 xhr.open("GET","http://www.google.com/bookmarks/?output=xml&num=10000",true);
                                 xhr.onreadystatechange = function() {
                                     if (xhr.readyState == 4){
                                         googleBookmarks = xhr.responseXML.documentElement.getElementsByTagName('bookmark');
                                         //console.log(googleBookmarks[0].childNodes);
                                         var gmarks = new Array();
                                         var labels = [];
                                         for(var i=0; i < googleBookmarks.length; i++){
                                             var gmark = { };
                                             for(var n=0; n < googleBookmarks[i].childNodes.length; n++){
                                                 if(googleBookmarks[i].childNodes[n].nodeName == 'labels'){
                                                     var label = googleBookmarks[i].childNodes[n].firstChild.childNodes[0].nodeValue;
                                                     // console.log(googleBookmarks[i].childNodes[n].firstChild.childNodes[0]);
                                                     gmark['label'] = label;
                                                     labels.push(label);
                                                 }
                                                 // console.log(googleBookmarks[i].childNodes[n].firstChild.nodeValue);
                                                 gmark[googleBookmarks[i].childNodes[n].nodeName] = googleBookmarks[i].childNodes[n].firstChild.nodeValue;
                                             }
                                             //console.log(gmark);
                                             // b_url = googleBookmarks[i].childNodes[1].firstChild.nodeValue;
                                             // b_title = googleBookmarks[i].childNodes[0].firstChild.nodeValue;
                                             // gmark = {url: b_url, title: b_title};
                                             // gmarks.push(gmark);
                                         }
                                         labels = unique(labels);
                                         //console.log(labels);
                                         for(var c=0;c < chromeBookmarks.length; c++){
                                             for(var z=0;z < labels.length; z++){
                                             label = labels[z];
                                          
                                             //        console.log(label);
                                            //         console.log(chromeBookmarks[c]['title']);
                                            
                                                 if(chromeBookmarks[c]['title'] == "Random"){
                                                     //labels.splice(z,1);
                                                  
                                                 }
                                             }
                                             
                                         }
                                         // for(var z=0;z < labels.length; z++){
                                         //     label = labels[z];
                                         //     //  chrome.bookmarks.create({'parentId': '2', 'title': label});                                                                         //         }
                                          console.log(labels);
                                         mergeBookmarks(chromeBookmarks, gmarks);
                                     };
                                 };
                                 xhr.send(null);
                             });
}


function unique(a){
    var r = new Array();
    o:for(var i = 0, n = a.length; i < n; i++)
    {
        for(var x = 0, y = r.length; x < y; x++)
        {
            if(r[x]==a[i]) continue o;
        }
        r[r.length] = a[i];
    }
    return r;
}


function displayChromeBookmarks(){
    console.log(chromeBookmarks);
}


function mergeBookmarks(cBookmarks, gBookmarks){
    //console.log(cBookmarks);
    //console.log(gBookmarks);
    for(var i=0; i < cBookmarks.length; i++){
        for(var n=0; n < gBookmarks.length; n++){
            cBookmarkURL = cBookmarks[i]['url'];
            gBookmarkURL = gBookmarks[n]['url'];
            
            if(cBookmarkURL == gBookmarkURL){
                //console.log("Match");
                //console.log(cBookmarkURL);
                //console.log(gBookmarkURL);
                gBookmarks.splice(n,1);
            }

            //console.log("###################");
        }
    }
    // console.log(cBookmarks);
    // console.log(gBookmarks);
    //console.log("###################");
    var merged = new Array();
    merged = gBookmarks.concat(cBookmarks);
    //console.log(merged);
    //cBookmarks.push(gBookmarks);
    // console.log(cBookmarks);
    if(gBookmarks.length > 0){
        createBookmarks(gBookmarks);        
    }
}


function createBookmarks(bookmarks){
    console.log(bookmarks);
    for(var i=0; i < bookmarks.length; i++){
        var bookmark = bookmarks[i];
        console.log(bookmark);
        bookmark_title = bookmark['title'];
        bookmark_url = bookmark['url'];

        chrome.bookmarks.create({'parentId': '2', 'title': bookmark_title, 'url': bookmark_url});
    }
}


// function displayBookmarks(){
//     list = document.createElement('ul');
//     for(var i=0; i < bookmarks.length; i++){
//         var bookmark = bookmarks[i];
//         list_item = document.createElement('li');
//         bookmark_title = bookmark.childNodes[0].firstChild.nodeValue;
//         bookmark_url = bookmark.childNodes[1].firstChild.nodeValue;

//         paragraph = document.createElement('p');
//         bookmark_link = document.createElement('A');
//         bookmark_link_text = document.createTextNode(bookmark_title);
//         open_bookmark_in_new_tab = 'chrome.tabs.create({url:' + "'" +  bookmark_url + "'" + '})';

//         bookmark_link.setAttribute('href',bookmark_url);
//         bookmark_link.setAttribute('onclick', open_bookmark_in_new_tab);
//         bookmark_link.appendChild(bookmark_link_text);

//         list_item.appendChild(bookmark_link);
//         list.appendChild(list_item);
//     }
//     document.body.appendChild(list);
// }



// function createAllBookmarks(bookmarks){
//     for(var i=0; i < bookmarks.length; i++){
//         var bookmark = bookmarks[i];

//         bookmark_title = bookmark.childNodes[0].firstChild.nodeValue;
//         bookmark_url = bookmark.childNodes[1].firstChild.nodeValue;

//         chrome.bookmarks.create({'parentId': '2', 'title': bookmark_title, 'url': bookmark_url});
//     }
// }







// function getAndMergeBookmarks(googleBookmarks){
//     chrome.bookmarks.getTree(function(bookmarkTreeNode, googleBookmarks) {mergeBookmarks(bookmarkTreeNode, googleBookmarks);});
// }

// function displayChromeBookmarks(chromeBookmarks){
//     for(var i=0; i < chromeBookmarks.length; i++){
//         bookmarks = chromeBookmarks[i].children;
//         for(var n=0; n < bookmarks[1].children.length; n++){
//            // console.log(bookmarks[1].children[n]);
//         }
//     }
//     return bookmarks[1].children;
// }


// function mergeBookmarks(){
// //    console.log(googleBookmarks);
//     // for(var i=0; i < chromeBookmarks.length; i++){
//       for(var n=0; n < googleBookmarks.length; n++){
//           bookmark_url = googleBookmarks[n].childNodes[1].firstChild.nodeValue;

//        //    console.log(matches);
// //           for(var i=0; i < matches.length; i++){
// //               console.log(googleBookmarks[n]);
// // //              googleBookmarks.splice(n,1);

// //           }
//     //         if(chromeBookmarks['url']){
//     //             chromeBookmarks.splice(i,1);
//     //         }
//      }
//     // }
// //    merged = chromeBookmarks.concat(googleBookmarks);
// }
</script>

    <style>
    body {
        min-width:200px;
    }

p {
    margin:0px;
}
</style>
    </head>
    <body onload="init()">
    <p><a href="#" onclick="displayBookmarks();">Display Bookmarks</a></p>
    <p><a href="#" onclick="createAllBookmarks();">Create Bookmarks</a></p>
    </body>
    </html>